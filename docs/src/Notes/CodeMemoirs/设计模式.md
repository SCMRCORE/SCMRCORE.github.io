---
title: "ğŸ§‘â€ğŸ’» è®¾è®¡æ¨¡å¼"
desc: "å¸¸ç”¨è®¾è®¡æ¨¡å¼çš„å­¦ä¹ å’Œä½¿ç”¨"
tags: "note"
updateTime: "2025-3-1 20:07"
outline: deep
---

# è®¾è®¡æ¨¡å¼

## é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™

### å•ä¸€èŒè´£åŸåˆ™

ä¸€ä¸ªå¯¹è±¡åº”è¯¥åªåŒ…å«å•ä¸€çš„èŒè´£ï¼Œå¹¶ä¸”è¯¥èŒè´£è¢«å®Œæ•´åœ°å°è£…åœ¨ä¸€ä¸ªç±»ä¸­ã€‚



### å¼€æ”¾å°é—­

è½¯ä»¶å®ä½“åº”å½“å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚



### é‡Œæ°æ›¿æ¢

æ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ã€‚

1. å­ç±»å¯ä»¥å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ï¼Œä½†ä¸èƒ½è¦†ç›–çˆ¶ç±»çš„éæŠ½è±¡æ–¹æ³•ã€‚
2. å­ç±»å¯ä»¥å¢åŠ è‡ªå·±ç‰¹æœ‰çš„æ–¹æ³•ã€‚
3. å½“å­ç±»çš„æ–¹æ³•é‡è½½çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œæ–¹æ³•çš„å‰ç½®æ¡ä»¶ï¼ˆå³æ–¹æ³•çš„è¾“å…¥/å…¥å‚ï¼‰è¦æ¯”çˆ¶ç±»æ–¹æ³•çš„è¾“å…¥å‚æ•°æ›´å®½æ¾ã€‚
4. å½“å­ç±»çš„æ–¹æ³•å®ç°çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼ˆé‡å†™/é‡è½½æˆ–å®ç°æŠ½è±¡æ–¹æ³•ï¼‰ï¼Œæ–¹æ³•çš„åç½®æ¡ä»¶ï¼ˆå³æ–¹æ³•çš„è¾“å‡º/è¿”å›å€¼ï¼‰è¦æ¯”çˆ¶ç±»æ›´ä¸¥æ ¼æˆ–ä¸çˆ¶ç±»ä¸€æ ·ã€‚



### ä¾èµ–å€’è½¬åŸåˆ™

é«˜å±‚æ¨¡å—ä¸åº”ä¾èµ–äºåº•å±‚æ¨¡å—ï¼Œå®ƒä»¬éƒ½åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚æŠ½è±¡ä¸åº”ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚

ä½¿ç”¨Springæ¡†æ¶å‰ï¼šä¼šå‘ç°å‡ ä¸ªclassæ˜¯å¼ºå…³è”çš„

```java
public class Main {

    public static void main(String[] args) {
        UserController controller = new UserController();
      	//è¯¥æ€ä¹ˆç”¨å°±è¿™ä¹ˆç”¨
    }

    static class UserMapper {
        //CRUD...
    }

    static class UserService {
        UserMapper mapper = new UserMapper();
        //ä¸šåŠ¡ä»£ç ....
    }

    static class UserController {
        UserService service = new UserService();
        //ä¸šåŠ¡ä»£ç ....
    }
}
```

ä½¿ç”¨Springæ¡†æ¶åï¼šç›´æ¥ä½¿ç”¨æ¥å£æ¯”å¦‚UserServiceï¼Œå°±ç®—æ”¹å®ç°UserServiceImplï¼ŒControllerä¹Ÿä¸éœ€è¦æ”¹å˜ã€‚å°†å¼ºå…³è”å¼±åŒ–

```java
public class Main {

    public static void main(String[] args) {
        UserController controller = new UserController();
    }

    interface UserMapper {
        //æ¥å£ä¸­åªåšCRUDæ–¹æ³•å®šä¹‰
    }

    static class UserMapperImpl implements UserMapper {
        //å®ç°ç±»å®ŒæˆCRUDå…·ä½“å®ç°
    }

    interface UserService {
        //ä¸šåŠ¡ä»£ç å®šä¹‰....
    }

    static class UserServiceImpl implements UserService {
        @Resource   //ç°åœ¨ç”±Springæ¥ä¸ºæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªæŒ‡å®šçš„å®ç°ç±»ï¼Œç„¶åæ³¨å…¥ï¼Œè€Œä¸æ˜¯ç”±æˆ‘ä»¬åœ¨ç±»ä¸­ç¡¬ç¼–ç è¿›è¡ŒæŒ‡å®š
        UserMapper mapper;
        
        //ä¸šåŠ¡ä»£ç å…·ä½“å®ç°
    }

    static class UserController {
        @Resource
        UserService service;   //ç›´æ¥ä½¿ç”¨æ¥å£ï¼Œå°±ç®—ä½ æ”¹å®ç°ï¼Œæˆ‘ä¹Ÿä¸éœ€è¦å†ä¿®æ”¹ä»£ç äº†

        //ä¸šåŠ¡ä»£ç ....
    }
}
```



### æ¥å£éš”ç¦»

å®¢æˆ·ç«¯ä¸åº”ä¾èµ–é‚£äº›å®ƒä¸éœ€è¦çš„æ¥å£ã€‚



### åˆæˆå¤ç”¨åŸåˆ™

ä¼˜å…ˆä½¿ç”¨å¯¹è±¡ç»„åˆï¼Œè€Œä¸æ˜¯é€šè¿‡ç»§æ‰¿æ¥è¾¾åˆ°å¤ç”¨çš„ç›®çš„ã€‚

æ¯”å¦‚åé¢çš„ä»£ç†æ¨¡å¼å’Œè£…é¥°æ¨¡å¼



### è¿ªç±³ç‰¹æ³•åˆ™(æœ€å°‘çŸ¥è¯†)

æ¯ä¸€ä¸ªè½¯ä»¶å•ä½å¯¹å…¶ä»–å•ä½éƒ½åªæœ‰æœ€å°‘çš„çŸ¥è¯†ï¼Œè€Œä¸”å±€é™äºé‚£äº›ä¸æœ¬å•ä½å¯†åˆ‡ç›¸å…³çš„è½¯ä»¶å•ä½ã€‚

ç®€å•æ¥è¯´å°±æ˜¯ï¼Œä¸€ä¸ªç±»/æ¨¡å—å¯¹å…¶ä»–çš„ç±»/æ¨¡å—æœ‰è¶Šå°‘çš„äº¤äº’è¶Šå¥½ã€‚





## åˆ›å»ºå‹

### å·¥å‚æ–¹æ³•æ¨¡å¼

ç›´æ¥newçš„æ–¹å¼åˆ›å»ºå¯¹è±¡çš„è¯ï¼Œå¦‚æœ**çªç„¶è¿™ä¸ªå¯¹è±¡çš„æ„é€ æ–¹æ³•æˆ–æ˜¯ç±»åå‘ç”Ÿäº†æ”¹å˜**ï¼Œå²‚ä¸æ˜¯**å¾—æŒ¨ç€ä¿®æ”¹**ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠéœ€è¦é¢‘ç¹å‡ºç°çš„å¯¹è±¡ï¼Œ**åˆ›å»ºè¿‡ç¨‹å°è£…åœ¨å·¥å‚ç±»ä¸­ï¼Œéœ€è¦å¯¹è±¡æ—¶ç›´æ¥è°ƒç”¨å·¥å‚ç±»çš„æ–¹æ³•ç”Ÿæˆå¯¹è±¡ã€‚**

> **ç®€å•å·¥å‚æ¨¡å¼**

å…ˆå®šä¹‰ä¸€äº›ç±»

```java
public abstract class Fruit {   //æ°´æœæŠ½è±¡ç±»
    private final String name;
    
    public Fruit(String name){
        this.name = name;
    }

    @Override
    public String toString() {
        return name+"@"+hashCode();   //æ‰“å°ä¸€ä¸‹å½“å‰æ°´æœåç§°ï¼Œè¿˜æœ‰å¯¹è±¡çš„hashCode
    }
}
```

```java
public class Apple extends Fruit{   //è‹¹æœï¼Œç»§æ‰¿è‡ªæ°´æœ

    public Apple() {
        super("è‹¹æœ");
    }
}
```

```java
public class Orange extends Fruit{  //æ©˜å­ï¼Œä¹Ÿæ˜¯ç»§æ‰¿è‡ªæ°´æœ
    public Orange() {
        super("æ©˜å­");
    }
}
```

ç°åœ¨æŠŠå¯¹è±¡åˆ›å»ºå°è£…åœ¨å·¥å‚ä¸­ï¼š

```java
public class FruitFactory {
    /**
     * è¿™é‡Œå°±ç›´æ¥æ¥ä¸€ä¸ªé™æ€æ–¹æ³•æ ¹æ®æŒ‡å®šç±»å‹è¿›è¡Œåˆ›å»º
     * @param type æ°´æœç±»å‹
     * @return å¯¹åº”çš„æ°´æœå¯¹è±¡
     */
    public static Fruit getFruit(String type) {
        switch (type) {
            case "è‹¹æœ":
                return new Apple();
           	case "æ©˜å­":
                return new Orange();
            default:
                return null;
        }
    }
}
```

ç®€å•å·¥å‚ä½¿ç”¨ï¼š

```java
public class Main {
    public static void main(String[] args) {
        Fruit fruit = FruitFactory.getFruit("æ©˜å­");   //ç›´æ¥é—®å·¥å‚è¦ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬è‡ªå·±å»åˆ›å»º
        System.out.println(fruit);
    }
}
```

**é—®é¢˜**ï¼šè¿™æ ·å†™çš„è¯å¹¶ä¸æ»¡è¶³å¼€æ”¾å°é—­åŸåˆ™ï¼Œåº”è¯¥å¯¹æ‹“å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¦æ–°å¢æ°´æœå°±**è¦ä¿®æ”¹å·¥å‚æ–¹æ³•çš„getFruitæ–¹æ³•**ï¼Œè¿™æ ·æ˜¾ç„¶æ˜¯**è¿èƒŒ**çš„ã€‚

> **å·¥å‚æ¨¡å¼**

é€šè¿‡æŠ½è±¡ç±»å’Œæ³›å‹ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ°´æœçš„åŸºç±»ï¼Œåç»­æ–°å¢æ°´æœåªéœ€è¦æ–°å»ºæ–°æ°´æœçš„å·¥å‚ç±»å³å¯ï¼š

```java
public abstract class FruitFactory<T extends Fruit> {   //å°†æ°´æœå·¥å‚æŠ½è±¡ä¸ºæŠ½è±¡ç±»ï¼Œæ·»åŠ æ³›å‹Tç”±å­ç±»æŒ‡å®šæ°´æœç±»å‹
    public abstract T getFruit();  //ä¸åŒçš„æ°´æœå·¥å‚ï¼Œé€šè¿‡æ­¤æ–¹æ³•ç”Ÿäº§ä¸åŒçš„æ°´æœ
}
```

```java
public class AppleFactory extends FruitFactory<Apple> {  
    //è‹¹æœå·¥å‚ï¼Œç›´æ¥è¿”å›Appleï¼Œä¸€æ­¥åˆ°ä½
    @Override
    public Apple getFruit() {
        return new Apple();
    }
}
```

ä½¿ç”¨

```java
public class Main {
    public static void main(String[] args) {
        test(new AppleFactory()::getFruit);   
        //æ¯”å¦‚æˆ‘ä»¬ç°åœ¨è¦åƒä¸€ä¸ªè‹¹æœï¼Œé‚£ä¹ˆå°±ç›´æ¥é€šè¿‡è‹¹æœå·¥å‚æ¥è·å–è‹¹æœ
    }

    //æ­¤æ–¹æ³•æ¨¡æ‹Ÿåƒæ‰ä¸€ä¸ªæ°´æœ
    private static void test(Supplier<Fruit> supplier){
        System.out.println(supplier.get()+" è¢«åƒæ‰äº†ï¼ŒçœŸå¥½åƒã€‚");
    }
}
```

- `Supplier<Fruit>` è¡¨ç¤ºä¸€ä¸ªå¯ä»¥æä¾› `Fruit` ç±»å‹å¯¹è±¡çš„ä¾›ç»™è€…ã€‚

- `Supplier<Fruit>` ä½œä¸ºä¸€ä¸ªå‚æ•°ç±»å‹è¢«ä¼ é€’ç»™æ–¹æ³• `test`ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ä¼ å…¥ä»»ä½•èƒ½å¤Ÿç”Ÿæˆ `Fruit` å®ä¾‹çš„æ–¹æ³•å¼•ç”¨æˆ–Lambdaè¡¨è¾¾å¼ã€‚



### æŠ½è±¡å·¥å‚æ¨¡å¼

å¦‚æœæœ‰å¤šä¸ªäº§å“çš„è¯ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼å°±ä¼šæ˜¾å¾—æœ‰ç‚¹åƒåŠ›ï¼Œå› ä¸ºè¦åˆ›å»ºå¤šä¸ªäº§å“çš„å·¥å‚å’Œæ–¹æ³•ã€‚

å› æ­¤æˆ‘ä»¬å¯ä»¥å°†å¤šä¸ªäº§å“éƒ½æ”¾åœ¨ä¸€ä¸ªå·¥å‚é‡Œï¼ŒæŒ‰ç…§äº§å“æ—åˆ’åˆ†ï¼š

```java
public class Router {
}
```

```java
public class Table {
}
```

```java
public class Phone {
}
```

```java
public abstract class AbstractFactory {
    public abstract Phone getPhone();
    public abstract Table getTable();
    public abstract Router getRouter();
}
```

ä¸è¿‡ï¼Œç¼ºç‚¹è¿˜æ˜¯æœ‰çš„ï¼Œå¦‚æœ**äº§å“æ—æ–°å¢äº†äº§å“**ï¼Œé‚£ä¹ˆæˆ‘å°±ä¸å¾—ä¸å»**ä¸ºæ¯ä¸€ä¸ªäº§å“æ—çš„å·¥å‚éƒ½å»æ·»åŠ æ–°äº§å“çš„ç”Ÿäº§æ–¹æ³•**ï¼Œ**è¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚**



### å»ºé€ è€…æ¨¡å¼

å°±æ˜¯æˆ‘ä»¬å¸¸è§çš„xxxBuilderã€‚

å®é™…ä¸Šæˆ‘ä»¬ä¸»è¦é€šè¿‡å»ºé€ è€…æ¥ä¸æ–­é…ç½®å‚æ•°æˆ–è€…å†…å®¹ï¼Œé…ç½®å®Œæ‰€æœ‰å†…å®¹ï¼Œå†å¯¹å¯¹è±¡è¿›è¡Œæ„å»ºã€‚

**å¸¸è§„çš„æ„å»ºå¯¹è±¡ï¼š**

è¦å¡«éå¸¸å¤šå‚æ•°

```java
public static void main(String[] args) {
    Student student = new Student(1, 18, 3, "å°æ˜", "è®¡ç®—æœºå­¦é™¢", "è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯", Arrays.asList("ICPC-ACM åŒºåŸŸèµ› é‡‘ç‰Œ", "LPL 2022æ˜¥å­£èµ› å† å†›"));
}
```

**å»ºé€ è€…æ¨¡å¼ï¼š**

åˆ›å»ºä¸€ä¸ªBuilderå†…éƒ¨ç±»ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªbuilder()æ–¹æ³•æ¥åˆ›å»ºå»ºé€ è€…ã€‚åœ¨å†…éƒ¨ç±»é‡Œå†™å¥½ç»™å‚æ•°èµ‹å€¼çš„æ–¹æ³•å³å¯ã€‚

```java
public class Student {
		...

    //ä¸€å¾‹ä½¿ç”¨å»ºé€ è€…æ¥åˆ›å»ºï¼Œä¸å¯¹å¤–ç›´æ¥å¼€æ”¾
    private Student(int id, int age, int grade, String name, String college, String profession, List<String> awards) {
        ...
    }

    public static StudentBuilder builder(){   //é€šè¿‡builderæ–¹æ³•ç›´æ¥è·å–å»ºé€ è€…
        return new StudentBuilder();
    }

    public static class StudentBuilder{   //è¿™é‡Œå°±ç›´æ¥åˆ›å»ºä¸€ä¸ªå†…éƒ¨ç±»
        //Builderä¹Ÿéœ€è¦å°†æ‰€æœ‰çš„å‚æ•°éƒ½è¿›è¡Œæš‚æ—¶ä¿å­˜ï¼Œæ‰€ä»¥Studentæ€ä¹ˆå®šä¹‰çš„è¿™é‡Œå°±æ€ä¹ˆå®šä¹‰
        int id;
        int age;
        int grade;
        String name;
        String college;
        String profession;
        List<String> awards;

        public StudentBuilder id(int id){    //ç›´æ¥è°ƒç”¨å»ºé€ è€…å¯¹åº”çš„æ–¹æ³•ï¼Œä¸ºå¯¹åº”çš„å±æ€§èµ‹å€¼
            this.id = id;
            return this;   //ä¸ºäº†æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œè¿™é‡Œç›´æ¥è¿”å›å»ºé€ è€…æœ¬èº«ï¼Œä¸‹åŒ
        }

        public StudentBuilder age(int age){
            this.age = age;
            return this;
        }
      
      	...

        public StudentBuilder awards(String... awards){
            //è¿™ä¸ªString...æ˜¯å¯å˜å‚æ•°ï¼Œæ˜¯çœŸå®å­˜åœ¨çš„ï¼Œç­‰åŒäºString[]
            this.awards = Arrays.asList(awards);
            return this;
        }
        
        public Student build(){    //æœ€åæˆ‘ä»¬åªéœ€è¦è°ƒç”¨å»ºé€ è€…æä¾›çš„buildæ–¹æ³•å³å¯æ ¹æ®æˆ‘ä»¬çš„é…ç½®è¿”å›ä¸€ä¸ªå¯¹è±¡
            return new Student(id, age, grade, name, college, profession, awards);
        }
    }
}
```

ç°åœ¨å¯ä»¥ä½¿ç”¨å»ºé€ è€…æ¥ç”Ÿæˆå¯¹è±¡äº†ï¼š

```java
public static void main(String[] args) {
    Student student = Student.builder()   //è·å–å»ºé€ è€…
            .id(1)    //é€æ­¥é…ç½®å„ä¸ªå‚æ•°
            .age(18)
            .grade(3)
            .name("å°æ˜")
            .awards("ICPC-ACM åŒºåŸŸèµ› é‡‘ç‰Œ", "LPL 2022æ˜¥å­£èµ› å† å†›")
            .build();   //æœ€åç›´æ¥å»ºé€ æˆ‘ä»¬æƒ³è¦çš„å¯¹è±¡
}
```



### å•ä¾‹æ¨¡å¼(singleton)

å°±æ˜¯æ•´ä¸ªç¨‹åºä¸­å§‹ç»ˆåªæœ‰è¿™ä¸€ä¸ªå¯¹è±¡ã€‚

æœ€ç®€å•çš„é¥¿æ±‰å¼å•ä¾‹ï¼š

```java
public class Singleton {
    private static Singleton INSTANCE;   //åœ¨ä¸€å¼€å§‹å…ˆä¸è¿›è¡Œå¯¹è±¡åˆ›å»º

    private Singleton() {}   //ä¸å…è®¸newï¼Œåªèƒ½é€šè¿‡ä¸‹æ–¹getè·å–

    public static Singleton getInstance(){   //å°†å¯¹è±¡çš„åˆ›å»ºå»¶ååˆ°éœ€è¦æ—¶å†è¿›è¡Œ
        if(INSTANCE == null) {    
            //å¦‚æœå®ä¾‹ä¸ºç©ºï¼Œé‚£ä¹ˆå°±è¿›è¡Œåˆ›å»ºï¼Œä¸ä¸ºç©ºè¯´æ˜å·²ç»åˆ›å»ºè¿‡äº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›
            INSTANCE = new Singleton();
        }
        return INSTANCE;
    }
}
```

ä½†æ˜¯è¿™æ ·åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å®¹æ˜“å‡ºé—®é¢˜ï¼Œåœ¨æçŸ­é—´éš”å†…å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ¤æ–­åˆ°Instanceä¸ºnullåˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å¼•å…¥æˆ‘ä»¬çš„synchroinzedå’Œvolatile

```java
public class Singleton {
    private static volatile Singleton INSTANCE;   //åœ¨ä¸€å¼€å§‹å…ˆä¸è¿›è¡Œå¯¹è±¡åˆ›å»º

    private Singleton() {}   //ä¸å…è®¸newï¼Œåªèƒ½é€šè¿‡ä¸‹æ–¹getè·å–

    public static Singleton getInstance(){
        if(INSTANCE == null) {
            synchronized (Singleton.class) {
                if(INSTANCE == null) INSTANCE = new Singleton();  
                //å†…å±‚è¿˜è¦è¿›è¡Œä¸€æ¬¡æ£€æŸ¥ï¼ŒåŒé‡æ£€æŸ¥é”å®š
            }
        }
        return INSTANCE;
    }
}
```

ä¸‰ä¸ªè¦ç‚¹ï¼š

- **ç›´æ¥é”æ–¹æ³•çš„è¯é«˜å¹¶å‘ä¸‹æ•ˆç‡å¤ªä½äº† --> å¯ä»¥é”ä»£ç å—ã€‚**
- **åŒæ ·æ˜¯æçŸ­æ—¶é—´å†…å¤šä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶åˆ¤æ–­ä¸ºnullï¼Œç„¶ååŒæ—¶å¤„äºé”ç­‰å¾… --> å¯ä»¥double check**
- **æ™®é€šInstanceå˜é‡çš„ä¿®æ”¹å¯èƒ½æ— æ³•å³ä½¿è¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ° --> ä½¿ç”¨volatileä¿®é¥°ä¿è¯å¯è§æ€§**



äº†è§£ï¼š

é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰ä¸€ç§æ›´å¥½çš„ï¼Œä¸ç”¨åŠ é”çš„æ–¹å¼ä¹Ÿèƒ½å®ç°å»¶è¿ŸåŠ è½½çš„å†™æ³•å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é™æ€å†…éƒ¨ç±»ï¼š

```java
public class Singleton {
    private Singleton() {}

    private static class Holder {   //ç”±é™æ€å†…éƒ¨ç±»æŒæœ‰å•ä¾‹å¯¹è±¡ï¼Œä½†æ˜¯æ ¹æ®ç±»åŠ è½½ç‰¹æ€§ï¼Œæˆ‘ä»¬ä»…ä½¿ç”¨Singletonç±»æ—¶ï¼Œä¸ä¼šå¯¹é™æ€å†…éƒ¨ç±»è¿›è¡Œåˆå§‹åŒ–
        private final static Singleton INSTANCE = new Singleton();
    }

    public static Singleton getInstance(){   //åªæœ‰çœŸæ­£ä½¿ç”¨å†…éƒ¨ç±»æ—¶ï¼Œæ‰ä¼šè¿›è¡Œç±»åˆå§‹åŒ–
        return Holder.INSTANCE;   //ç›´æ¥è·å–å†…éƒ¨ç±»ä¸­çš„
    }
}
```

è¿™ç§æ–¹å¼æ˜¾ç„¶æ˜¯æœ€å®Œç¾çš„æ‡’æ±‰å¼è§£å†³æ–¹æ¡ˆï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•çš„åŠ é”æ“ä½œï¼Œä¹Ÿèƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸è¿‡è¦å®ç°è¿™ç§å†™æ³•ï¼Œè·Ÿè¯­è¨€æœ¬èº«ä¹Ÿæœ‰ä¸€å®šçš„å…³è”ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¯­è¨€éƒ½æ”¯æŒè¿™ç§å†™æ³•ã€‚



### åŸå‹æ¨¡å¼(prototype)

å…¶å®å°±æ˜¯ä»¥åŸå¯¹è±¡ä¸ºæ¨¡æ¿é€šè¿‡å®ç°/é‡å†™clone()æ–¹æ³•ï¼Œæ¥åˆ›å»ºå¤šä¸ªå¯¹è±¡ã€‚

clone()æ–¹æ³•å°±æ¶‰åŠåˆ°æ·±æ‹·è´å’Œæµ…æ‹·è´ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸å¤šè¯´ã€‚ç›´æ¥é‡å†™clone()æ–¹æ³•ï¼Œå¯¹å¼•ç”¨å­—æ®µå…‹éš†å³å¯

```java
class MyClass implements Cloneable {
    private String field1;
    private NestedClass nestedObject;

    @Override
    protected Object clone() throws CloneNotSupportedException {
        MyClass cloned = (MyClass) super.clone();//æ™®é€šæ‹·è´å€¼ç±»å‹å¯¹è±¡
        cloned.nestedObject = (NestedClass) nestedObject.clone(); // æ·±æ‹·è´å†…éƒ¨çš„å¼•ç”¨å¯¹è±¡
        return cloned;
    }
}

class NestedClass implements Cloneable {
    private int nestedField;

    @Override
    protected Object clone() throws CloneNotSupportedException {
        return super.clone();
    }
}
```

æµ‹è¯•ï¼šç»“æœä¸ºfalse

```java
public class Main {

    public static void main(String[] args) throws InterruptedException, CloneNotSupportedException {
        MyClass myClass = new MyClass(new NestedClass());
        MyClass myClass1 = (MyClass) myClass.clone();
        System.out.println(myClass.getNestedObject()==myClass1.getNestedObject());
    }
}
```



**PS:ä¸è¦å¿˜äº†Stringä¹Ÿæ˜¯å¼•ç”¨ç±»å‹ï¼Œæµ…æ‹·è´ä¹Ÿåªä¼šæ‹·è´ä¸ªå¼•ç”¨**

```java
@Override
public Object clone() throws CloneNotSupportedException {   //è¿™é‡Œæˆ‘ä»¬æ”¹è¿›ä¸€ä¸‹ï¼Œé’ˆå¯¹æˆå‘˜å˜é‡ä¹Ÿè¿›è¡Œæ‹·è´
    Student student = (Student) super.clone();
    student.name = new String(name);
    return student;   //æˆå‘˜æ‹·è´å®Œæˆåï¼Œå†è¿”å›
}
```

å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹ `field1` ä½¿ç”¨æµ…æ‹·è´æ˜¯å®‰å…¨çš„ï¼Œå¹¶ä¸ä¼šå¯¼è‡´æ‰€è°“çš„â€œæ‹·è´é©¬â€é—®é¢˜ï¼ˆè¿™é‡Œå¯èƒ½æ˜¯æŒ‡æ•°æ®ä¸ä¸€è‡´æˆ–æ„å¤–çš„æ•°æ®å…±äº«é—®é¢˜ï¼‰ã€‚å®é™…ä¸Šï¼Œç”±äº `String` çš„ä¸å¯å˜æ€§ï¼Œæµ…æ‹·è´å’Œæ·±æ‹·è´å¯¹äº `String` ç±»å‹çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚











## ç»“æ„å‹

### é€‚é…å™¨æ¨¡å¼

Aæ–¹æ³•éœ€è¦Bå‚æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬åªæœ‰Cå‚æ•°ï¼Œäºæ˜¯é€šè¿‡DæŠŠCå’ŒBå…³è”èµ·æ¥ã€‚ä¹Ÿå°±æ˜¯é€‚é…å™¨ã€‚

ä¾‹å­ï¼š

```java
public class TestSupplier {   //æ‰‹æœºä¾›åº”å•†

    public String doSupply(){
        return "iPhone 14 Pro";
    }
}
```

```java
public class Main {
    public static void main(String[] args) {
        TestSupplier supplier = new TestSupplier();
      	test( ? );   //æˆ‘ä»¬æ²¡æœ‰Targetç±»å‹çš„æ‰‹æœºä¾›åº”å•†ï¼Œåªæœ‰å…¶ä»–çš„ï¼Œé‚£è¿™é‡Œè¯¥å¡«ä¸ªå•¥
    }

    public static void test(Target target){   
        //ç°åœ¨æˆ‘ä»¬éœ€è¦è°ƒç”¨testæ–¹æ³•ï¼Œä½†æ˜¯testæ–¹æ³•éœ€è¦Targetç±»å‹çš„æ‰‹æœºä¾›åº”å•†
        System.out.println("æˆåŠŸå¾—åˆ°ï¼š"+target.supply());
    }
}
```

å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªTargetæ¥å£ï¼Œç¼–å†™æˆ‘ä»¬è¦ä½¿ç”¨çš„åŸç±»/å¯¹è±¡TestSupplierçš„æ–¹æ³•ã€‚

```java
public interface Target {    //ç°åœ¨çš„æ‰‹æœºä¾›åº”å•†ï¼Œå¹¶ä¸æ˜¯testæ–¹æ³•æ‰€éœ€è¦çš„é‚£ç§ç±»å‹

    String supply();
}
```

æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªé€‚é…å™¨ç±»ï¼Œç»§æ‰¿åŸç±»ï¼Œå®ç°Targetæ¥å£ã€‚

```java
public class TestAdapter extends TestSupplier implements Target {  
  //è®©æˆ‘ä»¬çš„é€‚é…å™¨ç»§æ‰¿TestSupplierå¹¶ä¸”å®ç°Targetæ¥å£
    @Override
    public String supply() {   //æ¥ç€å®ç°supplyæ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨TestSupplieræä¾›çš„å®ç°
        return super.doSupply();
    }
}
```

è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨äº†ï¼šç›´æ¥ä¼ å…¥é€‚é…å™¨ç±»

```java
public static void main(String[] args) {
    TestAdapter adapter = new TestAdapter();
    test(adapter);
}

public static void test(Target target){
    System.out.println("æˆåŠŸå¾—åˆ°ï¼š"+target.supply());
}
```

**é—®é¢˜**ï¼šè¿™ç§é€‚é…å™¨ç±»å†™æ³•ä¼šå ç”¨ä¸€ä¸ªextendsçš„å‘ä½ï¼Œæˆ‘ä»¬å¯ä»¥æ¢ä¸€ç§å†™æ³•ï¼š

é€šè¿‡åˆæˆå¤ç”¨åŸåˆ™ï¼š

```java
public class TestAdapter implements Target{   
    //ç°åœ¨ä¸å†ç»§æ‰¿TestSupplierï¼Œä»…å®ç°Target

    TestSupplier supplier;
    
    public TestAdapter(TestSupplier supplier){
        this.supplier = supplier;
    }
    
    @Override
    public String supply() {
        return supplier.doSupply();
    }
}
```



### æ¡¥æ¥æ¨¡å¼

æƒ…æ™¯ï¼šä¹°å¥¶èŒ¶çš„æ—¶å€™ï¼Œä¸­æ¯å¤§æ¯è¶…å¤§æ¯ï¼Œè¿˜è¦åŠ ä»€ä¹ˆé…æ–™......

å¦‚æœè®¾è®¡Teaæ¥å£ï¼ŒSizeæ¥å£ï¼Œç„¶åå†å»åˆ†åˆ«å®ç°æ¯”å¦‚ï¼šå¤§æ¯èŠ‹åœ†å¥¶èŒ¶...

```java
public interface Tea {   //ç”±å…·ä½“ç±»å‹çš„å¥¶èŒ¶å®ç°
    String getType();   //ä¸åŒçš„å¥¶èŒ¶è¿”å›çš„ç±»å‹ä¸åŒ
}
public interface Size {   //åˆ†å¤§æ¯å°æ¯ä¸­æ¯
    String getSize();
}
```

å®ç°ï¼š

```java
/**
 * å¤§æ¯èŠ‹åœ†å•µå•µå¥¶èŒ¶
 */
public class LargeKissTea implements Tea, Size{

    @Override
    public String getSize() {
        return "å¤§æ¯";
    }

    @Override
    public String getType() {
        return "èŠ‹åœ†å•µå•µå¥¶èŒ¶";
    }
}
```

è¿™æ ·çš„è¯çœ‹ç€æŒºåˆç†çš„ï¼Œä½†æ˜¯ä¸€æ—¦æ•°é‡å¤šèµ·æ¥ï¼Œé‚£å°±å¾—åˆ›å»ºå¥½å¤šå¥½å¤šç±»ï¼Œæ¯”å¦‚å°æ¯èŠ‹åœ†ä¸åŠ ç³–ï¼Œä¸­æ¯èŠ‹åœ†åŠ ç³–........

è¿™æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„æ¡¥æ¥æ¨¡å¼äº†ï¼Œç°åœ¨æˆ‘ä»¬é¢ä¸´çš„é—®é¢˜æ˜¯ï¼Œ**ç»´åº¦å¤ªå¤šï¼Œä¸å¯èƒ½å„ç§ç±»å‹å„ç§å°ºå¯¸çš„å¥¶èŒ¶éƒ½å»åˆ›å»ºä¸€ä¸ªç±»**ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¿˜æ˜¯**å•ç‹¬å¯¹è¿™äº›æ¥å£è¿›è¡Œç®€å•çš„æ‰©å±•ï¼Œå•ç‹¬å¯¹ä¸åŒçš„ç»´åº¦è¿›è¡Œæ§åˆ¶**ï¼Œä½†æ˜¯å¦‚ä½•å®ç°å‘¢ï¼Ÿæˆ‘ä»¬ä¸å¦¨å°†å¥¶èŒ¶çš„ç±»å‹ä½œä¸ºæœ€åŸºæœ¬çš„æŠ½è±¡ç±»ï¼Œç„¶åå¯¹å°ºå¯¸ã€é…æ–™ç­‰å±æ€§è¿›è¡Œæ¡¥æ¥ï¼š

```java
public abstract class AbstractTea {
    
    protected Size size;   //å°ºå¯¸ä½œä¸ºæ¡¥æ¥å±æ€§å­˜æ”¾åœ¨ç±»ä¸­
    
    protected AbstractTea(Size size){   //åœ¨æ„é€ æ—¶éœ€è¦çŸ¥é“å°ºå¯¸å±æ€§
        this.size = size;
    }
    
    public abstract String getType();   //å…·ä½“ç±»å‹ä¾ç„¶æ˜¯ç”±å­ç±»å†³å®š
}
```

ä¸è¿‡è¿™ä¸ªæŠ½è±¡ç±»æä¾›çš„æ–¹æ³•è¿˜ä¸å…¨é¢ï¼Œä»…ä»…åªæœ‰Teaçš„getTypeæ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ·»åŠ å…¶ä»–ç»´åº¦çš„æ–¹æ³•ï¼Œæ‰€ä»¥ç»§ç»­ç¼–å†™ä¸€ä¸ªå­ç±»ï¼š

```java
public abstract class RefinedAbstractTea extends AbstractTea{
    protected RefinedAbstractTea(Size size) {
        super(size);
    }
    
    public String getSize(){   //æ·»åŠ å°ºå¯¸ç»´åº¦è·å–æ–¹å¼
        return size.getSize();
    }
}
```

å•ç‹¬ä¸ºsizeåˆ›å»ºå­ç±»ï¼š

```java
public class Large implements Size{

    @Override
    public String getSize() {
        return "å¤§æ¯";
    }
}
```

ç°åœ¨çš„è¯å°±å¯ä»¥ï¼š

```java
public class KissTea extends RefinedAbstractTea{   //åˆ›å»ºä¸€ä¸ªå•µå•µèŠ‹åœ†å¥¶èŒ¶çš„å­ç±»
    protected KissTea(Size size) {   //åœ¨æ„é€ æ—¶éœ€è¦æŒ‡å®šå…·ä½“çš„å¤§å°å®ç°
        super(size);
    }

    @Override
    public String getType() {
        return "å•µå•µèŠ‹åœ†å¥¶èŒ¶";   //è¿”å›å¥¶èŒ¶ç±»å‹
    }
}
```

ç°åœ¨å°±å°†å°ºå¯¸å’Œç§ç±»ä¸¤ä¸ªç»´åº¦ç»™æ‹†å¼€äº†ï¼š

```java
public static void main(String[] args) {
    KissTea tea = new KissTea(new Large());
    System.out.println(tea.getType());
    System.out.println(tea.getSize());
}
```

**ä¸ªäººç†è§£**ï¼šå®é™…ä¸Šå°±æ˜¯AbstractTeaè´Ÿè´£Typeç›¸å…³èŒè´£ä¹Ÿå°±æ˜¯getTypeï¼Œè€Œå­æŠ½è±¡ç±»RefinedAbstractTeaåˆ™å¯ä»¥æ‹“å±•ä¸€ä¸ªSizeç±»èŒè´£ï¼Œä¹Ÿå°±æ˜¯getSize()è¿™æ ·çš„è¯æˆ‘ä»¬æœ€ç»ˆçš„å®ç°ç±»KissTeaç»§æ‰¿å­æŠ½è±¡ç±»å°±èƒ½å®ç°ä¸¤ä¸ªèŒè´£äº†ï¼ŒåŒæ—¶ä¹Ÿä¸è¿èƒŒå•ä¸€èŒè´£åŸåˆ™ã€‚ï¼ˆå­æŠ½è±¡ç±»ä¸å¼ºåˆ¶å®ç°çˆ¶ç±»æŠ½è±¡æ–¹æ³•ï¼‰

> **æ€è€ƒï¼š**ä¸ºä»€ä¹ˆä¸ç›´æ¥åœ¨AbstractTeaé‡Œå†™getSize()å‘¢ï¼Ÿ
>
> è¿åäº†å•ä¸€èŒè´£åŸåˆ™ï¼Œä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚
>
> **æ¡¥æ¥æ¨¡å¼çš„æœ¬è´¨**ï¼šæ¡¥æ¥æ¨¡å¼çš„ä¸€ä¸ªå…³é”®ç‚¹åœ¨äº**å®ƒå…è®¸æŠ½è±¡éƒ¨åˆ†ï¼ˆè¿™é‡Œæ˜¯èŒ¶çš„ç±»å‹ï¼‰å’Œå…¶å®ç°éƒ¨åˆ†ï¼ˆå¦‚å°ºå¯¸ã€å‘³é“ç­‰ï¼‰èƒ½å¤Ÿç‹¬ç«‹åœ°å˜åŒ–**ã€‚é€šè¿‡è®© `RefinedAbstractTea` ç»§æ‰¿ `AbstractTea` å¹¶æ·»åŠ  `getSize` æ–¹æ³•ï¼Œå¯ä»¥æ›´å¥½åœ°ä½“ç°è¿™ä¸€æ€æƒ³â€”â€”ä½ å¯ä»¥è‡ªç”±åœ°åœ¨ä¸ä¿®æ”¹ `AbstractTea` çš„æƒ…å†µä¸‹ï¼Œä¸ºç‰¹å®šçš„å®ç°ï¼ˆå¦‚ `RefinedAbstractTea` åŠå…¶å­ç±»ï¼‰æ·»åŠ åŠŸèƒ½æˆ–æ”¹å˜è¡Œä¸ºã€‚



### ç»„åˆæ¨¡å¼

å°†å¤šä¸ªç»„ä»¶è¿›è¡Œç»„åˆï¼Œè®©ç”¨æˆ·è¿›è¡Œä¸€è‡´æ€§å¤„ç†ã€‚æ¯”å¦‚æˆ‘ä»¬çš„ç»„ä»¶å¤¹ï¼Œä¸€ä¸ªæ–‡ä»¶å¤¹å¯ä»¥æœ‰å¤šä¸ªå­æ–‡ä»¶å¤¹æˆ–è€…æ–‡ä»¶ã€‚

![image-20250228154359866](../../public/è®¾è®¡æ¨¡å¼.assets/image-20250228154359866.png)

å®ƒå°±åƒæ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ä¸€æ ·ï¼Œæœ‰åˆ†æ”¯æœ‰å¶å­ï¼Œè€Œç»„åˆæ¨¡å¼åˆ™æ˜¯å¯ä»¥å¯¹æ•´ä¸ªæ ‘å½¢ç»“æ„ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œé€’å½’å¤„ç†ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨å¸Œæœ›å°†æ‰€æœ‰æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶çš„åç§°å‰é¢éƒ½æ·»åŠ ä¸€ä¸ªå‰ç¼€ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ç»„åˆæ¨¡å¼ã€‚

```java
/**
 * é¦–å…ˆåˆ›å»ºä¸€ä¸ªç»„ä»¶æŠ½è±¡ï¼Œç»„ä»¶å¯ä»¥åŒ…å«ç»„ä»¶ï¼Œç»„ä»¶æœ‰è‡ªå·±çš„ä¸šåŠ¡æ–¹æ³•
 */
public abstract class Component {
    public abstract void addComponent(Component component);    //æ·»åŠ å­ç»„ä»¶
    public abstract void removeComponent(Component component);   //åˆ é™¤å­ç»„ä»¶
    public abstract Component getChild(int index);   //è·å–å­ç»„ä»¶
    public abstract void test();   //æ‰§è¡Œå¯¹åº”çš„ä¸šåŠ¡æ–¹æ³•ï¼Œæ¯”å¦‚ä¿®æ”¹æ–‡ä»¶åç§°
}
```

æ¥ç€æˆ‘ä»¬æ¥ç¼–å†™ä¸¤ç§å®ç°ç±»ï¼š

```java
public class Directory extends Component{   //ç›®å½•å¯ä»¥åŒ…å«å¤šä¸ªæ–‡ä»¶æˆ–ç›®å½•

    List<Component> child = new ArrayList<>();   //è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Listæ¥å­˜æ”¾ç›®å½•ä¸­çš„å­ç»„ä»¶

    @Override
    public void addComponent(Component component) {
        child.add(component);
    }

    @Override
    public void removeComponent(Component component) {
        child.remove(component);
    }

    @Override
    public Component getChild(int index) {
        return child.get(index);
    }

    @Override
    public void test() {
        child.forEach(Component::test);   //å°†ç»§ç»­è°ƒç”¨æ‰€æœ‰å­ç»„ä»¶çš„testæ–¹æ³•æ‰§è¡Œä¸šåŠ¡
    }
}
```

```java
public class File extends Component{   //æ–‡ä»¶å°±ç›¸å½“äºæ˜¯æ ‘å¶ï¼Œæ— æ³•å†ç»§ç»­æ·»åŠ å­ç»„ä»¶äº†

    @Override
    public void addComponent(Component component) {
        throw new UnsupportedOperationException();   //ä¸æ”¯æŒè¿™äº›æ“ä½œäº†
    }

    @Override
    public void removeComponent(Component component) {
        throw new UnsupportedOperationException();
    }

    @Override
    public Component getChild(int index) {
        throw new UnsupportedOperationException();
    }

    @Override
    public void test() {
        System.out.println("æ–‡ä»¶åç§°ä¿®æ”¹æˆåŠŸï¼"+this);   //å…·ä½“çš„åç§°ä¿®æ”¹æ“ä½œ
    }
}
```

æœ€åï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š

```java
public static void main(String[] args) {
    Directory outer = new Directory();   //æ–°å»ºä¸€ä¸ªå¤–å±‚ç›®å½•
    Directory inner = new Directory();   //æ–°å»ºä¸€ä¸ªå†…å±‚ç›®å½•
    outer.addComponent(inner);
    outer.addComponent(new File());   //åœ¨å†…å±‚ç›®å½•å’Œå¤–å±‚ç›®å½•éƒ½æ·»åŠ ç‚¹æ–‡ä»¶ï¼Œæ³¨æ„åˆ«å¯¼é”™åŒ…äº†
    inner.addComponent(new File());
    inner.addComponent(new File());
    outer.test();    //å¼€å§‹æ‰§è¡Œæ–‡ä»¶åç§°ä¿®æ”¹æ“ä½œ
}
```



### è£…é¥°æ¨¡å¼

é€šè¿‡ç»„åˆè€Œéä¼ ç»Ÿç»§æ‰¿å…³ç³»ï¼Œå¯¹ç°æœ‰ç±»è¿›è¡Œè£…é¥°ã€‚

æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªæ™®é€šçš„åŠŸèƒ½ç±»ï¼š

```java
public abstract class Base {   //é¡¶å±‚æŠ½è±¡ç±»ï¼Œå®šä¹‰äº†ä¸€ä¸ªtestæ–¹æ³•æ‰§è¡Œä¸šåŠ¡
    public abstract void test();
}

public class BaseImpl extends Base{
    @Override
    public void test() {
        System.out.println("æˆ‘æ˜¯ä¸šåŠ¡æ–¹æ³•");   //å…·ä½“çš„ä¸šåŠ¡æ–¹æ³•
    }
}
```

ä¸è¿‡ç°åœ¨çš„å®ç°ç±»å¤ªå•è°ƒäº†ï¼Œæˆ‘ä»¬æ¥æ·»åŠ ä¸€ç‚¹è£…é¥°ä¸Šå»ï¼š

```java
public class Decorator extends Base{   //è£…é¥°è€…éœ€è¦å°†è£…é¥°ç›®æ ‡ç»„åˆåˆ°ç±»ä¸­

    protected Base base;

    public Decorator(Base base) {
        this.base = base;
    }

    @Override
    public void test() {
        base.test();    //è¿™é‡Œæš‚æ—¶è¿˜æ˜¯ä½¿ç”¨ç›®æ ‡çš„åŸæœ¬æ–¹æ³•å®ç°
    }
}
```

```java
public class DecoratorImpl extends Decorator{   //è£…é¥°å®ç°

    public DecoratorImpl(Base base) {
        super(base);
    }

    @Override
    public void test() {    //å¯¹åŸæœ¬çš„æ–¹æ³•è¿›è¡Œè£…é¥°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‰åéƒ½å»æ·»åŠ é¢å¤–æ“ä½œ
        System.out.println("è£…é¥°æ–¹æ³•ï¼šæˆ‘æ˜¯æ“ä½œå‰é€»è¾‘");
        super.test();
        System.out.println("è£…é¥°æ–¹æ³•ï¼šæˆ‘æ˜¯æ“ä½œåé€»è¾‘");
    }
}
```

è¿™æ ·ï¼Œæˆ‘ä»¬å°±é€šè¿‡è£…é¥°æ¨¡å¼å¯¹ç±»çš„åŠŸèƒ½è¿›è¡Œäº†æ‰©å±•ï¼š

```java
public static void main(String[] args) {
    Base base = new BaseImpl();
    Decorator decorator = new DecoratorImpl(base);  //å°†Baseå®ç°è£…é¥°ä¸€ä¸‹
    Decorator outer = new DecoratorImpl(decorator);  //è£…é¥°è€…è¿˜å¯ä»¥åµŒå¥—

    decorator.test();

    outer.test();
}
```

è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†è£…é¥°æ¨¡å¼ã€‚



### ä»£ç†æ¨¡å¼

ä»£ç†æ¨¡å¼å’Œè£…é¥°æ¨¡å¼å¾ˆåƒï¼Œå½“æ— æ³•ç›´æ¥è®¿é—®æŸä¸ªå¯¹è±¡æˆ–è®¿é—®æŸä¸ªå¯¹è±¡å­˜åœ¨å›°éš¾æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸€ä¸ªä»£ç†å¯¹è±¡æ¥é—´æ¥è®¿é—®ã€‚

ä¾‹å­ï¼šéœ€è¦è¢«ä»£ç†çš„Subjectï¼š

```java
public abstract class Subject {
    public abstract void test();
}
```

```java
public class SubjectImpl extends Subject{  //æ­¤ç±»æ— æ³•ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦æˆ‘ä»¬è¿›è¡Œä»£ç†

    @Override
    public void test() {
        System.out.println("æˆ‘æ˜¯æµ‹è¯•æ–¹æ³•ï¼");
    }
}
```

> **æœ€åŸºç¡€çš„ä»£ç†**

å°†è¢«ä»£ç†å¯¹è±¡ç»„åˆåˆ°ç±»ä¸­ï¼Œç„¶åé‡å†™æ–¹æ³•

```java
public class Proxy extends Subject{   //ä¸ºäº†ä¿è¯å’ŒSubjectæ“ä½œæ–¹å¼ä¸€æ ·ï¼Œä¿è¯é€æ˜æ€§ï¼Œä¹Ÿå¾—ç»§æ‰¿

    Subject target;   //è¢«ä»£ç†çš„å¯¹è±¡ï¼ˆç”šè‡³å¯ä»¥å¤šé‡ä»£ç†ï¼‰

    public Proxy(Subject subject){
        this.target = subject;
    }

    @Override
    public void test() {   //ç”±ä»£ç†å»æ‰§è¡Œè¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜å¯ä»¥åœ¨å‰åæ·»æ²¹åŠ é†‹
        System.out.println("ä»£ç†å‰ç»•æ–¹æ³•");
        target.test();
        System.out.println("ä»£ç†åç»•æ–¹æ³•");
    }
}
```

PS:çœ‹èµ·æ¥ç¡®å®å’ŒåŸºç¡€çš„ä»£ç†æ¨¡å¼æœ‰ç‚¹åƒï¼š

- è£…é¥°å™¨æ¨¡å¼å¼ºè°ƒçš„æ˜¯å¢å¼ºè‡ªèº«ï¼Œåœ¨è¢«è£…é¥°ä¹‹åä½ èƒ½å¤Ÿåœ¨è¢«å¢å¼ºçš„ç±»ä¸Šä½¿ç”¨å¢å¼ºåçš„åŠŸèƒ½ï¼Œå¢å¼ºåä½ è¿˜æ˜¯ä½ ï¼Œåªä¸è¿‡è¢«å¼ºåŒ–äº†è€Œå·²ï¼›
- ä»£ç†æ¨¡å¼å¼ºè°ƒè¦è®©åˆ«äººå¸®ä½ å»åšäº‹æƒ…ï¼Œä»¥åŠæ·»åŠ ä¸€äº›æœ¬èº«ä¸ä½ ä¸šåŠ¡æ²¡æœ‰å¤ªå¤šå…³ç³»çš„äº‹æƒ…ï¼ˆè®°å½•æ—¥å¿—ã€è®¾ç½®ç¼“å­˜ç­‰ï¼‰é‡ç‚¹åœ¨äºè®©åˆ«äººå¸®ä½ åšã€‚

> **JDK Proxyçš„åŠ¨æ€ä»£ç†æœºåˆ¶**(å…«è‚¡)

åªèƒ½æ˜¯æ¥å£å½¢å¼ï¼š

```java
public interface Subject {  //JDKæä¾›çš„åŠ¨æ€ä»£ç†åªæ”¯æŒæ¥å£
    void test();
}
```

```java
public class SubjectImpl implements Subject{

    @Override
    public void test() {
        System.out.println("æˆ‘æ˜¯æµ‹è¯•æ–¹æ³•ï¼");
    }
}
```

æ³¨æ„ï¼šä¸‹é¢ä¼ å…¥å‚æ•°çš„éƒ½æ˜¯impl

å…·ä½“ï¼š

```java
public class TestProxy implements InvocationHandler {    //ä»£ç†ç±»ï¼Œéœ€è¦å®ç°InvocationHandleræ¥å£

    private final Object object;   //è¿™é‡Œéœ€è¦ä¿å­˜ä¸€ä¸‹è¢«ä»£ç†çš„å¯¹è±¡ï¼Œä¸‹é¢éœ€è¦ç”¨åˆ°

    public TestProxy(Object object) {
        this.object = object;
    }

    @Override   //æ­¤æ–¹æ³•å°±æ˜¯è°ƒç”¨ä»£ç†å¯¹è±¡çš„å¯¹åº”æ–¹æ³•æ—¶ä¼šè¿›å…¥ï¼Œè¿™é‡Œæˆ‘ä»¬å°±éœ€è¦ç¼–å†™å¦‚ä½•è¿›è¡Œä»£ç†äº†
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
     		//methodå°±æ˜¯è°ƒç”¨çš„ä»£ç†å¯¹è±¡çš„å“ªä¸€ä¸ªæ–¹æ³•ï¼Œargsæ˜¯å®å‚æ•°ç»„
        System.out.println("ä»£ç†çš„å¯¹è±¡ï¼š"+proxy.getClass());   //proxyå°±æ˜¯ç”Ÿæˆçš„ä»£ç†å¯¹è±¡äº†ï¼Œæˆ‘ä»¬çœ‹çœ‹æ˜¯ä»€ä¹ˆç±»å‹çš„
        Object res = method.invoke(object, args);   //åœ¨ä»£ç†ä¸­è°ƒç”¨è¢«ä»£ç†å¯¹è±¡åŸæœ¬çš„æ–¹æ³•ï¼Œå› ä¸ºä½ æ˜¯ä»£ç†ï¼Œè¿˜æ˜¯å¾—æ‰§è¡Œä¸€ä¸‹åˆ«äººçš„ä¸šåŠ¡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸æ‰§è¡Œï¼Œä½†æ˜¯è¿™æ ·å°±å¤±å»ä»£ç†çš„æ„ä¹‰äº†ï¼Œæ³¨æ„è¦ç”¨ä¸Šé¢çš„object
        System.out.println("æ–¹æ³•è°ƒç”¨å®Œæˆï¼Œè¿”å›å€¼ä¸ºï¼š"+res);   //çœ‹çœ‹è¿”å›å€¼æ˜¯ä»€ä¹ˆ
        return res;   //è¿”å›è¿”å›å€¼
    }
}
```

ç›´æ¥æ˜¯å®ç°InvocationHandleræ¥å£ï¼ŒåŒæ ·éœ€è¦æˆ‘ä»¬ç»„åˆè¢«ä»£ç†å¯¹è±¡ã€‚

```java
public static void main(String[] args) {
    SubjectImpl subject = new SubjectImpl();   //è¢«ä»£ç†çš„å¤§å†¤ç§
    InvocationHandler handler = new TestProxy(subject);
    Subject proxy = (Subject) Proxy.newProxyInstance(
            subject.getClass().getClassLoader(),    //éœ€è¦ä¼ å…¥è¢«ä»£ç†çš„ç±»çš„ç±»åŠ è½½å™¨
            subject.getClass().getInterfaces(),    //éœ€è¦ä¼ å…¥è¢«ä»£ç†çš„ç±»çš„æ¥å£åˆ—è¡¨
            handler);    //æœ€åä¼ å…¥æˆ‘ä»¬å®ç°çš„ä»£ç†å¤„ç†é€»è¾‘å®ç°ç±»
    proxy.test();    //æ¯”å¦‚ç°åœ¨æˆ‘ä»¬è°ƒç”¨ä»£ç†ç±»çš„testæ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥åˆ°æˆ‘ä»¬ä¸Šé¢TestProxyä¸­invokeæ–¹æ³•ï¼Œèµ°æˆ‘ä»¬çš„ä»£ç†é€»è¾‘
}
```

> **CGLIBçš„åŠ¨æ€ä»£ç†æœºåˆ¶**(å…«è‚¡)

```java
<dependency>
    <groupId>cglib</groupId>
    <artifactId>cglib</artifactId>
    <version>3.1</version>
</dependency>
```

ç”±äºCGlibåº•å±‚ä½¿ç”¨ASMæ¡†æ¶ï¼ˆJVMç¯‡è§†é¢‘æ•™ç¨‹æœ‰ä»‹ç»ï¼‰è¿›è¡Œå­—èŠ‚ç ç¼–è¾‘ï¼Œæ‰€ä»¥èƒ½å¤Ÿå®ç°ä¸ä»…ä»…å±€é™äºå¯¹æ¥å£çš„ä»£ç†ï¼š

```java
public class TestProxy implements MethodInterceptor {  //é¦–å…ˆè¿˜æ˜¯ç¼–å†™æˆ‘ä»¬çš„ä»£ç†é€»è¾‘

    private final Object target;   //è¿™äº›å’Œä¹‹å‰JDKåŠ¨æ€ä»£ç†å†™æ³•æ˜¯ä¸€æ ·çš„

    public TestProxy(Object target) {
        this.target = target;
    }

    @Override   //æˆ‘ä»¬ä¹Ÿæ˜¯éœ€è¦åœ¨è¿™é‡Œå»ç¼–å†™æˆ‘ä»¬çš„ä»£ç†é€»è¾‘
    public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable {
        System.out.println("ç°åœ¨æ˜¯ç”±CGLibè¿›è¡Œä»£ç†æ“ä½œï¼"+o.getClass());
        return method.invoke(target, objects);   //ä¹Ÿæ˜¯ç›´æ¥è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•å³å¯
    }
}
```

æ¥ç€æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸‹ä»£ç†ç±»ï¼š

```java
public static void main(String[] args) {
    SubjectImpl subject = new SubjectImpl();

    Enhancer enhancer = new Enhancer();   //å¢å¼ºå™¨ï¼Œä¸€ä¼šå°±éœ€è¦ä¾é å¢å¼ºå™¨æ¥ä¸ºæˆ‘ä»¬ç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡
    enhancer.setSuperclass(SubjectImpl.class);    //ç›´æ¥é€‰æ‹©æˆ‘ä»¬éœ€è¦ä»£ç†çš„ç±»å‹ï¼Œç›´æ¥ä¸éœ€è¦æ¥å£æˆ–æ˜¯æŠ½è±¡ç±»ï¼ŒSuperClassä½œä¸ºä»£ç†ç±»çš„çˆ¶ç±»å­˜åœ¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§æŒ‡å®šç±»å‹çš„æ–¹å¼å»æ“ä½œä»£ç†ç±»äº†
    enhancer.setCallback(new TestProxy(subject));  //è®¾å®šæˆ‘ä»¬åˆšåˆšç¼–å†™å¥½çš„ä»£ç†é€»è¾‘

    SubjectImpl proxy = (SubjectImpl) enhancer.create();   //ç›´æ¥åˆ›å»ºä»£ç†ç±»

    proxy.test();   //è°ƒç”¨ä»£ç†ç±»çš„testæ–¹æ³•
}
```



### å¤–è§‚æ¨¡å¼(å¾…å­¦ä¹ )



### äº«å…ƒæ¨¡å¼(å¸¦å­¦ä¹ )



## è¡Œä¸ºå‹

### æ¨¡æ¿æ–¹æ³•æ¨¡å¼

åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œ**å¯èƒ½æŸäº›æ“ä½œæ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨ç±»ä¸­å¯¹åº”æ–¹æ³•è¿›è¡Œç¼–å†™**ï¼Œä½†æ˜¯å¯èƒ½**æŸäº›æ“ä½œéœ€è¦è§†æƒ…å†µè€Œå®šï¼Œç”±ä¸åŒçš„å­ç±»å®ç°æ¥å†³å®š**ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬å°±**éœ€è¦è®©è¿™äº›æ“ä½œç”±å­ç±»æ¥å»¶è¿Ÿå®ç°äº†**ã€‚ç°åœ¨æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°**æ¨¡æ¿æ–¹æ³•æ¨¡å¼**ã€‚

```java
/**
 * æŠ½è±¡è¯Šæ–­æ–¹æ³•ï¼Œå› ä¸ºç°åœ¨åªçŸ¥é“æŒ‚å·å’Œçœ‹åŒ»ç”Ÿæ˜¯å›ºå®šæ¨¡å¼ï¼Œå‰©ä¸‹çš„å¼€å¤„æ–¹å’Œæ‹¿è¯éƒ½æ˜¯ä¸ç¡®å®šçš„
 */
public abstract class AbstractDiagnosis {

    public void test(){
        System.out.println("ä»Šå¤©å¤´å¥½æ™•ï¼Œä¸æƒ³èµ·åºŠï¼Œå¼€æ‘†ï¼Œå…ˆè·Ÿå…¬å¸è¯·ä¸ªå‡");
        System.out.println("å»åŒ»é™¢çœ‹ç—…äº†~");
        System.out.println("1 >> å…ˆæŒ‚å·");
        System.out.println("2 >> ç­‰å¾…å«å·");
        //ç”±äºç°åœ¨ä¸çŸ¥é“è¯¥å¼€ä»€ä¹ˆå¤„æ–¹ï¼Œæ‰€ä»¥åªèƒ½å…ˆå®šä¹‰ä¸€ä¸‹è¡Œä¸ºï¼Œç„¶åå…·ä½“ç”±å­ç±»å®ç°
      	//å¤§è‡´çš„æµç¨‹å…ˆå®šä¹‰å¥½å°±è¡Œ
        this.prescribe();
        this.medicine();  //å¼€è¯åŒç†
    }

    public abstract void prescribe();   //å¼€å¤„æ–¹æ“ä½œæ ¹æ®å…·ä½“ç—…ç—‡å†³å®šäº†

    public abstract void medicine();   //æ‹¿è¯ä¹Ÿæ˜¯æ ¹æ®å…·ä½“çš„å¤„æ–¹å»æ‹¿
}
```

testå°±æ˜¯å›ºå®šçœ‹ç—…æµç¨‹ï¼Œè€Œä¸‹é¢ä¸¤ä¸ªæ–¹æ³•åˆ™æ˜¯éœ€è¦è§†æƒ…å†µè€Œå®šï¼Œç”±å­ç±»è‡ªè¡Œå®ç°ï¼š

```java
/**
 * æ„Ÿå†’ç›¸å…³çš„å…·ä½“å®ç°å­ç±»
 */
public class ColdDiagnosis extends AbstractDiagnosis{
    @Override
    public void prescribe() {
        System.out.println("3 >> ä¸€çœ¼ä¸çœŸï¼Œé‰´å®šä¸ºå‡ï¼Œä½ è¿™ä¸æ˜¯æ„Ÿå†’ï¼Œçº¯ç²¹æ˜¯æƒ³æ‘†çƒ‚");
    }

    @Override
    public void medicine() {
        System.out.println("4 >> å¼€ç‚¹å¤´å­¢å›å»åƒå§");
    }
}
```

ä½¿ç”¨ï¼š

```java
public static void main(String[] args) {
    AbstractDiagnosis diagnosis = new ColdDiagnosis();
    diagnosis.test();
}
```

PSï¼šJUCä¸­çš„AQSé‡Œå‡ºç°çš„ä»£ç ï¼š

```java
public final boolean release(int arg) {    //AQSçš„é”é‡Šæ”¾æ“ä½œ
    if (tryRelease(arg)) {   //å¯ä»¥çœ‹åˆ°è¿™é‡Œè°ƒç”¨äº†tryReleaseæ–¹æ³•ï¼Œä½†æ˜¯æ­¤æ–¹æ³•å¹¶ä¸æ˜¯åœ¨AQSå®ç°çš„ï¼Œè€Œæ˜¯ä¸åŒçš„é”è‡ªè¡Œå®ç°ï¼Œå› ä¸ºAQSä¹Ÿä¸çŸ¥é“ä½ è¿™ç§ç±»å‹çš„é”åˆ°åº•è¯¥æ€ä¹ˆå»è§£é”
        Node h = head;
        if (h != null && h.waitStatus != 0)
            unparkSuccessor(h);
        return true;
    }
    return false;
}

protected boolean tryRelease(int arg) {
    throw new UnsupportedOperationException();   //AQSä¸­ä¸æ”¯æŒï¼Œéœ€è¦å»¶è¿Ÿåˆ°å…·ä½“çš„å­ç±»å»å®ç°
}
```

æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå®é™…ä¸Šè¿™éƒ¨åˆ†åŠŸèƒ½çš„å®ç°æ˜¯åœ¨å­ç±»å®Œæˆçš„ï¼š

```java
protected final boolean tryRelease(int releases) {   
  //ReentrantLockä¸­çš„AQS Syncå®ç°ç±»ï¼Œå¯¹tryReleaseæ–¹æ³•è¿›è¡Œäº†å…·ä½“å®ç°
    int c = getState() - releases;
    if (Thread.currentThread() != getExclusiveOwnerThread())
        throw new IllegalMonitorStateException();
    boolean free = false;
    if (c == 0) {
        free = true;
        setExclusiveOwnerThread(null);
    }
    setState(c);
    return free;
}
```





### è´£ä»»é“¾æ¨¡å¼

è´£ä»»é“¾æ¨¡å¼ä¹Ÿéå¸¸å¥½ç†è§£ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„é’‰é’‰å®¡æ‰¹ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€æ¡æµæ°´çº¿ä¸€æ ·çš„æ“ä½œï¼Œç”±ä½ å‘èµ·ç”³è¯·ï¼Œç„¶åç»è¿‡å¤šä¸ªéƒ¨é—¨ä¸»ç®¡å®¡æ‰¹ï¼Œæœ€åæ‰èƒ½é€šè¿‡ï¼Œæ‰€ä»¥ä½ çš„ç”³è¯·è¡¨ç›¸å½“äºæ˜¯åœ¨ä¸€æ¡è´£ä»»é“¾ä¸Šä¼ é€’ã€‚å½“ç„¶**é™¤äº†è¿™æ ·çš„ç›´çº¿å‹è´£ä»»é“¾ä¹‹å¤–ï¼Œè¿˜æœ‰ç¯å½¢ã€æ ‘å½¢ç­‰**ã€‚

![image-20250301160807143](../../public/è®¾è®¡æ¨¡å¼.assets/image-20250301160807143.png)

å®é™…ä¸Šæˆ‘ä»¬ä¹‹å‰ä¹Ÿé‡åˆ°è¿‡å¾ˆå¤šç§è´£ä»»é“¾ï¼Œæ¯”å¦‚JavaWebä¸­å­¦ä¹ çš„Filterè¿‡æ»¤å™¨ï¼Œæ­£æ˜¯é‡‡ç”¨çš„è´£ä»»é“¾æ¨¡å¼ï¼Œé€šè¿‡å°†è¯·æ±‚ä¸€çº§ä¸€çº§ä¸æ–­å‘ä¸‹ä¼ é€’ï¼Œæ¥å¯¹æˆ‘ä»¬æ‰€éœ€è¦çš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤å’Œå¤„ç†ã€‚

è¿™é‡Œæˆ‘ä»¬å°±ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼æ¥æ¨¡æ‹Ÿä¸€ä¸ªç®€å•çš„é¢è¯•è¿‡ç¨‹ï¼Œæˆ‘ä»¬é¢è¯•ä¹Ÿæ˜¯ä¸€é¢äºŒé¢ä¸‰é¢è¿™æ ·èµ°çš„æµç¨‹ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆè®¾è®¡ä¸€ä¸‹è´£ä»»é“¾ä¸Šçš„å„ä¸ªå¤„ç†å™¨ï¼š

```java
public abstract class Handler {

    protected Handler successor;    //è¿™é‡Œæˆ‘ä»¬å°±è®¾è®¡è´£ä»»é“¾ä»¥å•é“¾è¡¨å½¢å¼å­˜åœ¨ï¼Œè¿™é‡Œå­˜æ”¾åç»§èŠ‚ç‚¹

    public Handler connect(Handler successor){     //æ‹¼æ¥åç»­èŠ‚ç‚¹
        this.successor = successor;
        return successor;  //è¿™é‡Œè¿”å›åç»§èŠ‚ç‚¹ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä¸€ä¼šé“¾å¼è°ƒç”¨
    }

    public void handle(){
        this.doHandle();   //ç”±ä¸åŒçš„å­ç±»å®ç°å…·ä½“å¤„ç†è¿‡ç¨‹
        Optional
                .ofNullable(successor)
                .ifPresent(Handler::handle);    //è´£ä»»é“¾ä¸Šå¦‚æœè¿˜æœ‰åç»§èŠ‚ç‚¹ï¼Œå°±ç»§ç»­å‘ä¸‹ä¼ é€’
    }

    public abstract void doHandle();   //ç»“åˆä¸ŠèŠ‚è¯¾å­¦ä¹ çš„æ¨¡æ¿æ–¹æ³•ï¼Œäº¤ç»™å­ç±»å®ç°
}
```

å› ä¸ºé¢è¯•æœ‰å¾ˆå¤šè½®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåˆ›å»ºå‡ ä¸ªå¤„ç†å™¨çš„å®ç°ï¼š

```java
public class FirstHandler extends Handler{   //ç”¨äºä¸€é¢çš„å¤„ç†å™¨
    @Override
    public void doHandle() {
        System.out.println("============= ç™½é©¬ç¨‹åºå‘˜ä¸€é¢ ==========");
        System.out.println("1. è°ˆè°ˆä½ å¯¹staticå…³é”®å­—çš„ç†è§£ï¼Ÿ");
        System.out.println("2. å†…éƒ¨ç±»å¯ä»¥è°ƒç”¨å¤–éƒ¨çš„æ•°æ®å—ï¼Ÿå¦‚æœæ˜¯é™æ€çš„å‘¢ï¼Ÿ");
        System.out.println("3. hashCode()æ–¹æ³•æ˜¯æ‰€æœ‰çš„ç±»éƒ½æœ‰å—ï¼Ÿé»˜è®¤è¿”å›çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ");
        System.out.println("ä»¥ä¸Šé—®é¢˜ä¼šçš„ï¼Œå¯ä»¥ä¾æ¬¡æ‰“åœ¨è¯„è®ºåŒº");
    }
}
```

```java
public class SecondHandler extends Handler{  //äºŒé¢
    @Override
    public void doHandle() {
        System.out.println("============= ç™½é©¬ç¨‹åºå‘˜äºŒé¢ ==========");
        System.out.println("1. å¦‚æœæˆ‘ä»¬è‡ªå·±åˆ›å»ºä¸€ä¸ªjava.langåŒ…å¹¶ä¸”ç¼–å†™ä¸€ä¸ªStringç±»ï¼Œèƒ½å¦å®ç°è¦†ç›–JDKé»˜è®¤çš„ï¼Ÿ");
        System.out.println("2. HashMapçš„è´Ÿè½½å› å­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿå˜åŒ–è§„å¾‹æ˜¯ä»€ä¹ˆï¼Ÿ");
        System.out.println("3. çº¿ç¨‹æ± çš„è¿ä½œæœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ");
        System.out.println("4. ReentrantLockå…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ");
        System.out.println("ä»¥ä¸Šé—®é¢˜ä¼šçš„ï¼Œå¯ä»¥ä¾æ¬¡æ‰“åœ¨è¯„è®ºåŒº");
    }
}
```

```java
public class ThirdHandler extends Handler{
    @Override
    public void doHandle() {
        System.out.println("============= ç™½é©¬ç¨‹åºå‘˜ä¸‰é¢ ==========");
        System.out.println("1. synchronizedå…³é”®å­—äº†è§£å—ï¼Ÿå¦‚ä½•ä½¿ç”¨ï¼Ÿåº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ");
        System.out.println("2. IOå’ŒNIOçš„åŒºåˆ«åœ¨å“ªé‡Œï¼ŸNIOä¸‰å¤§æ ¸å¿ƒç»„ä»¶ï¼Ÿ");
        System.out.println("3. TCPæ¡æ‰‹å’ŒæŒ¥æ‰‹æµç¨‹ï¼Ÿå°‘ä¸€æ¬¡æ¡æ‰‹å¯ä»¥å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ");
        System.out.println("4. æ“ä½œç³»ç»Ÿä¸­PCBæ˜¯åšä»€ä¹ˆçš„ï¼Ÿè¿è¡Œæœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ");
        System.out.println("ä»¥ä¸Šé—®é¢˜ä¼šçš„ï¼Œå¯ä»¥ä¾æ¬¡æ‰“åœ¨è¯„è®ºåŒº");
    }
}
```

è¿™æ ·æˆ‘ä»¬å°±ç¼–å†™å¥½äº†æ¯ä¸€è½®çš„é¢è¯•æµç¨‹ï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æ„å»ºä¸€ä¸ªè´£ä»»é“¾äº†ï¼š

```java
public static void main(String[] args) {
    Handler handler = new FirstHandler();  //ä¸€é¢é¦–å½“å…¶å†²
    handler
            .connect(new SecondHandler())   //ç»§ç»­è¿æ¥äºŒé¢å’Œä¸‰é¢
            .connect(new ThirdHandler());
    handler.handle();   //å¼€å§‹é¢è¯•
} 
```



### è¿­ä»£å™¨æ¨¡å¼

è¿­ä»£å™¨æˆ‘ä»¬åœ¨JavaSEç¯‡å°±å·²ç»è®²è§£è¿‡äº†ï¼Œè¿­ä»£å™¨å¯ä»¥è¯´æ˜¯æˆ‘ä»¬å­¦ä¹ Javaè¯­è¨€çš„åŸºç¡€ï¼Œ**æ²¡æœ‰è¿­ä»£å™¨ï¼Œé›†åˆç±»çš„éå†å°±æˆäº†é—®é¢˜**ï¼Œæ­£æ˜¯å› ä¸ºæœ‰è¿­ä»£å™¨çš„å­˜åœ¨ï¼Œæˆ‘ä»¬æ‰èƒ½æ›´åŠ ä¼˜é›…çš„ä½¿ç”¨foreachè¯­æ³•ã€‚

å›é¡¾æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨è¿­ä»£å™¨çš„åœºæ™¯ï¼š

```java
public static void main(String[] args) {
    List<String> list = Arrays.asList("AAA", "BBB", "CCC");
    for (String s : list) {   //ä½¿ç”¨foreachè¯­æ³•ç³–è¿›è¡Œè¿­ä»£ï¼Œä¾æ¬¡è·å–æ¯ä¸€ä¸ªå…ƒç´ 
        System.out.println(s);   //æ‰“å°ä¸€ä¸‹
    }
}
```

ç¼–è¯‘ä¹‹åçš„ä»£ç å¦‚ä¸‹ï¼š

```java
public static void main(String[] args) {
    List<String> list = Arrays.asList("AAA", "BBB", "CCC");
    Iterator var2 = list.iterator();   //å®é™…ä¸Šè¿™é‡Œæœ¬è´¨æ˜¯é€šè¿‡Listç”Ÿæˆçš„è¿­ä»£å™¨æ¥éå†æˆ‘ä»¬æ¯ä¸ªå…ƒç´ çš„

    while(var2.hasNext()) {   //åˆ¤æ–­æ˜¯å¦è¿˜æœ‰å…ƒç´ å¯ä»¥è¿­ä»£ï¼Œæ²¡æœ‰å°±false
        String s = (String)var2.next();   //é€šè¿‡nextæ–¹æ³•å¾—åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ï¼Œè¿­ä»£å™¨ä¼šå‘åç§»åŠ¨ä¸€ä½
        System.out.println(s);    //æ‰“å°ä¸€ä¸‹
    }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨è¿­ä»£å™¨å¯¹Listè¿›è¡Œéå†æ—¶ï¼Œå®é™…ä¸Šå°±åƒä¸€ä¸ªæŒ‡å‘åˆ—è¡¨å¤´éƒ¨çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬é€šè¿‡ä¸æ–­å‘åç§»åŠ¨æŒ‡é’ˆæ¥ä¾æ¬¡è·å–æ‰€æŒ‡å‘çš„å…ƒç´ ï¼š

![image-20250301161551850](../../public/è®¾è®¡æ¨¡å¼.assets/image-20250301161551850.png)

æˆ‘ä»¬è‡ªå·±çš„æ¨¡æ‹Ÿä¸€ä¸ªè¿­ä»£å™¨æ¥å£ï¼š

```java
public class ArrayCollection<T> {    //é¦–å…ˆè®¾è®¡ä¸€ä¸ªç®€å•çš„æ•°ç»„é›†åˆï¼Œä¸€ä¼šæˆ‘ä»¬å°±è¿­ä»£æ­¤é›†åˆå†…çš„å…ƒç´ 

    private final T[] array;   //åº•å±‚ä½¿ç”¨ä¸€ä¸ªæ•°ç»„æ¥å­˜æ”¾æ•°æ®

    private ArrayCollection(T[] array){   //privateæ‰ï¼Œè‡ªå·±ç”¨
        this.array = array;
    }

    public static <T> ArrayCollection<T> of(T[] array){   //å¼€ä¸ªé™æ€æ–¹æ³•ç›´æ¥å§æ•°ç»„è½¬æ¢æˆArrayCollectionï¼Œå…¶å®å’Œç›´æ¥newä¸€æ ·ï¼Œä½†æ˜¯è¿™æ ·å†™å¥½çœ‹ä¸€ç‚¹
        return new ArrayCollection<>(array);
    }
}
```

ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å°†æ•°æ®å­˜æ”¾åœ¨æ­¤é›†åˆä¸­äº†ï¼š

```java
public static void main(String[] args) {
    String[] arr = new String[]{"AAA", "BBB", "CCC", "DDD"};
    ArrayCollection<String> collection = ArrayCollection.of(arr);
}
```

ç„¶åæˆ‘ä»¬å®ç°è¿­ä»£å™¨æ¥å£ï¼š

```java
public class ArrayCollection<T> implements Iterable<T>{   //å®ç°Iterableæ¥å£è¡¨ç¤ºæ­¤ç±»æ˜¯æ”¯æŒè¿­ä»£çš„

    ...

    @Override
    public Iterator<T> iterator() {    //éœ€è¦å®ç°iteratoræ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œç”¨äºè¿­ä»£æˆ‘ä»¬é›†åˆä¸­çš„å…ƒç´ 
        return new ArrayIterator();
    }

    public class ArrayIterator implements Iterator<T> {   //è¿™é‡Œå®ç°ä¸€ä¸ªï¼Œæ³¨æ„åˆ«ç”¨é™æ€ï¼Œéœ€è¦ä½¿ç”¨å¯¹è±¡ä¸­å­˜æ”¾çš„æ•°ç»„
        private int cur = 0;   //è¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæŒ‡é’ˆè¡¨ç¤ºå½“å‰çš„è¿­ä»£ä½ç½®

        @Override
        public boolean hasNext() {     //åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ 
            return cur < array.length;   //å¦‚æœæŒ‡é’ˆå¤§äºæˆ–ç­‰äºæ•°ç»„æœ€å¤§é•¿åº¦ï¼Œå°±ä¸èƒ½å†ç»§ç»­äº†
        }

        @Override
        public T next() {   //è¿”å›å½“å‰æŒ‡é’ˆä½ç½®çš„å…ƒç´ å¹¶å‘åç§»åŠ¨ä¸€ä½
            return array[cur++];   //æ­£å¸¸è¿”å›å¯¹åº”ä½ç½®çš„å…ƒç´ ï¼Œå¹¶å°†æŒ‡é’ˆè‡ªå¢
        }
    }
}
```

æ¥ç€ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ä¸€ä¸ªç®€å•é›†åˆç±»è¿›è¡Œè¿­ä»£äº†ï¼š

```java
public static void main(String[] args) {
    String[] arr = new String[]{"AAA", "BBB", "CCC", "DDD"};
    ArrayCollection<String> collection = ArrayCollection.of(arr);
    for (String s : collection) {    //å¯ä»¥ç›´æ¥ä½¿ç”¨foreachè¯­æ³•ç³–ï¼Œå½“ç„¶æœ€åè¿˜æ˜¯ä¼šå˜æˆè¿­ä»£å™¨è°ƒç”¨
        System.out.println(s);
    }
}
```

æœ€åç¼–è¯‘å‡ºæ¥çš„æ ·å­ï¼š

```java
public static void main(String[] args) {
    String[] arr = new String[]{"AAA", "BBB", "CCC", "DDD"};
    ArrayCollection<String> collection = ArrayCollection.of(arr);
    Iterator var3 = collection.iterator();   //é¦–å…ˆè·å–è¿­ä»£å™¨ï¼Œå®é™…ä¸Šå°±æ˜¯è°ƒç”¨æˆ‘ä»¬å®ç°çš„iteratoræ–¹æ³•

    while(var3.hasNext()) {
        String s = (String)var3.next();   //ç›´æ¥ä½¿ç”¨next()æ–¹æ³•ä¸æ–­å‘ä¸‹è·å–
        System.out.println(s);
    }
}
```

è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†ä¸€ä¸ªè¿­ä»£å™¨æ¥éå†æˆ‘ä»¬çš„å…ƒç´ ã€‚



### è§‚å¯Ÿè€…æ¨¡å¼

åœ¨Javaä¸­ï¼Œä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œå¯èƒ½å°±ä¼šå½±å“åˆ°å…¶ä»–çš„å¯¹è±¡ï¼Œä¸ä¹‹ç›¸å…³çš„å¯¹è±¡å¯èƒ½ä¹Ÿä¼šè”åŠ¨çš„è¿›è¡Œæ”¹å˜ã€‚è¿˜æœ‰æˆ‘ä»¬ä¹‹å‰é‡åˆ°è¿‡çš„ç›‘å¬å™¨æœºåˆ¶ï¼Œå½“å…·ä½“çš„äº‹ä»¶è§¦å‘æ—¶ï¼Œæˆ‘ä»¬åœ¨ä¸€å¼€å§‹åˆ›å»ºçš„ç›‘å¬å™¨å°±å¯ä»¥æ‰§è¡Œç›¸å…³çš„é€»è¾‘ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼Œ**å½“å¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè§‚å¯Ÿè€…èƒ½å¤Ÿç«‹å³è§‚å¯Ÿåˆ°å¹¶è¿›è¡Œä¸€äº›è”åŠ¨æ“ä½œ**ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªè§‚å¯Ÿè€…æ¥å£ï¼š

```java
public interface Observer {   //è§‚å¯Ÿè€…æ¥å£
    void update();   //å½“å¯¹è±¡æœ‰æ›´æ–°æ—¶ï¼Œä¼šå›è°ƒæ­¤æ–¹æ³•
}
```

æ¥ç€æˆ‘ä»¬æ¥å†™ä¸€ä¸ªæ”¯æŒè§‚å¯Ÿè€…çš„å®ä½“ç±»ï¼š

````java
public class Subject {
    private final Set<Observer> observerSet = new HashSet<>();

    public void observe(Observer observer) {   //æ·»åŠ è§‚å¯Ÿè€…
        observerSet.add(observer);
    }

    public void modify() {   //æ¨¡æ‹Ÿå¯¹è±¡è¿›è¡Œä¿®æ”¹
        observerSet.forEach(Observer::update);   //å½“å¯¹è±¡å‘ç”Ÿä¿®æ”¹æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…ï¼Œå¹¶è¿›è¡Œæ–¹æ³•å›è°ƒ
    }
}
````

æ¥ç€æˆ‘ä»¬å°±å¯ä»¥æµ‹è¯•ä¸€ä¸‹äº†ï¼š

```java
public static void main(String[] args) {
    Subject subject = new Subject();
    subject.observe(() -> System.out.println("æˆ‘æ˜¯ä¸€å·è§‚å¯Ÿè€…ï¼"));
    subject.observe(() -> System.out.println("æˆ‘æ˜¯äºŒå·è§‚å¯Ÿè€…ï¼"));
    subject.modify();
}
```

è¿™æ ·ï¼Œæˆ‘ä»¬å°±ç®€å•å®ç°äº†ä¸€ä¸‹è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå½“ç„¶JDKä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†å®ç°è§‚å¯Ÿè€…æ¨¡å¼ç›¸å…³çš„æ¥å£ï¼š

```java
import java.util.Observable;    //java.utilåŒ…ä¸‹æä¾›çš„è§‚å¯Ÿè€…æŠ½è±¡ç±»

public class Subject extends Observable {   //ç»§æ‰¿æ­¤æŠ½è±¡ç±»è¡¨ç¤ºæ”¯æŒè§‚å¯Ÿè€…

    public void modify(){
        System.out.println("å¯¹å¯¹è±¡è¿›è¡Œä¿®æ”¹ï¼");
        this.setChanged();    //å½“å¯¹å¯¹è±¡ä¿®æ”¹åï¼Œéœ€è¦setChangedæ¥è®¾å®šä¸ºå·²ä¿®æ”¹çŠ¶æ€
        this.notifyObservers(new Date());   //ä½¿ç”¨notifyObserversæ–¹æ³•æ¥é€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…
      	//æ³¨æ„åªæœ‰å·²ä¿®æ”¹çŠ¶æ€ä¸‹é€šçŸ¥è§‚å¯Ÿè€…æ‰ä¼šæœ‰æ•ˆï¼Œå¹¶ä¸”å¯ä»¥ç»™è§‚å¯Ÿè€…ä¼ é€’å‚æ•°ï¼Œè¿™é‡Œä¼ é€’äº†ä¸€ä¸ªæ—¶é—´å¯¹è±¡
    }
}
```

æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹å§ï¼š

```java
public static void main(String[] args) {
    Subject subject = new Subject();
    subject.addObserver((o, arg) -> System.out.println("ç›‘å¬åˆ°å˜åŒ–ï¼Œå¹¶å¾—åˆ°å‚æ•°ï¼š"+arg));  
  	//æ³¨æ„è¿™é‡Œçš„Observeræ˜¯java.utilåŒ…ä¸‹æä¾›çš„
    subject.modify();   //è¿›è¡Œä¿®æ”¹æ“ä½œ
}
```



### ç­–ç•¥æ¨¡å¼

æˆ‘ä»¬å¯ä»¥ä¸ºå¯¹è±¡è®¾å®šä¸€ç§ç­–ç•¥ï¼Œè¿™æ ·å¯¹è±¡ä¹‹åçš„è¡Œä¸ºå°±ä¼šæŒ‰ç…§æˆ‘ä»¬åœ¨ä¸€å¼€å§‹æŒ‡å®šçš„ç­–ç•¥è€Œå†³å®šäº†ï¼Œçœ‹èµ·æ¥å’Œå‰é¢çš„çŠ¶æ€æ¨¡å¼å¾ˆåƒï¼Œä½†æ˜¯ï¼Œå®ƒ**ä¸çŠ¶æ€æ¨¡å¼çš„åŒºåˆ«åœ¨äºï¼Œè¿™ç§è½¬æ¢æ˜¯â€œä¸»åŠ¨â€çš„ï¼Œæ˜¯ç”±æˆ‘ä»¬å»æŒ‡å®šï¼Œè€ŒçŠ¶æ€æ¨¡å¼ï¼Œå¯èƒ½æ˜¯åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è‡ªåŠ¨åˆ‡æ¢çš„**ã€‚

å†æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªæ’åºç±»ï¼Œä½†æ˜¯æ ¹æ®ä¸åŒçš„ç­–ç•¥ï¼Œä¼šä½¿ç”¨ä¸åŒçš„æ’åºæ–¹æ¡ˆï¼š

```java
public interface Strategy {   //ç­–ç•¥æ¥å£ï¼Œä¸åŒçš„ç­–ç•¥å®ç°ä¹Ÿä¸åŒ

    Strategy SINGLE = Arrays::sort;   //å•çº¿ç¨‹æ’åºæ–¹æ¡ˆ
    Strategy PARALLEL = Arrays::parallelSort;   //å¹¶è¡Œæ’åºæ–¹æ¡ˆ
    
    void sort(int[] array);
}
```

ç°åœ¨æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæ’åºç±»ï¼š

```java
public class Sorter {

    private Strategy strategy;   //ç­–ç•¥

    public void setStrategy(Strategy strategy) {
        this.strategy = strategy;
    }

    public void sort(int[] array){
        strategy.sort(array);
    }
}
```

ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æŒ‡å®šä¸åŒçš„ç­–ç•¥è¿›è¡Œæ’åºäº†ï¼š

```java
public static void main(String[] args) {
    Sorter sorter = new Sorter();
    sorter.setStrategy(Strategy.PARALLEL);    //æŒ‡å®šä¸ºå¹¶è¡Œæ’åºæ–¹æ¡ˆ
    
    sorter.sort(new int[]{9, 2, 4, 5, 1, 0, 3, 7});
}
```







### è®¿é—®è€…æ¨¡å¼(å¾…å­¦ä¹ )



### è§£é‡Šå™¨æ¨¡å¼(äº†è§£)



### å‘½ä»¤æ¨¡å¼(å¾…å­¦ä¹ )



### ä¸­ä»‹è€…æ¨¡å¼(å¾…å­¦ä¹ )



### å¤‡å¿˜å½•æ¨¡å¼(å¾…å­¦ä¹ )

